<!-- Generated by SpecStory -->

# 確認安裝指示的圖片與文案對應 (2025-07-08 07:40Z)

_**User**_

幫我確認在@InstallInstructions.tsx中：

ios
手動安裝
QRcode安裝
一鍵安裝

android
手動安裝
QRcode安裝

圖片跟文案的對應關係各是什麼？

---

_**Assistant**_

好的，以下是根據你提供的 `InstallInstructions.tsx` 檔案，整理出 iOS/Android 各安裝方式「圖片」與「文案」的對應關係（即每一張圖片會顯示哪一段教學文字）：

---

## iOS

### 1. 手動安裝（manual）

- **圖片順序**（`IOS_MANUAL_IMAGES`）：
  1. ios_第一步.png
  2. ios_第二步.png
  3. ios_QR code_1.png
  4. ios_手動.png
  5. ios_第五步.png
  6. ios_第六步.png
  7. ios_第八步.png
  8. ios_第九步.png
  9. ios_第10步.png
  10. ios_第二階段＿第一步.png
  11. ios_第二階段＿第一步.png
  12. ios_第二階段＿第二步.png

- **文案對應**（`IOS_MANUAL_TEXT_INDEX`）：
  - 0, 0, 0 → 文案1（installation_manual.steps[0]）
  - 1, 1    → 文案2（installation_manual.steps[1]）
  - 2       → 文案3（installation_manual.steps[2]）
  - 3       → 文案4（installation_manual.steps[3]）
  - 4       → 文案5（installation_manual.steps[4]）
  - 5       → 文案6（installation_manual.steps[5]）
  - 6       → network_setup.steps[1]
  - 7       → network_setup.steps[2]
  - 8       → network_setup.steps[3]

---

### 2. QR code 安裝（qrcode）

- **圖片順序**（`IOS_QRCODE_IMAGES`）：
  1. ios_第一步.png
  2. ios_第二步.png
  3. ios_QR code_1.png
  4. ios_QR code_2.png
  5. ios_第五步.png
  6. ios_第六步.png
  7. ios_第八步.png
  8. ios_第九步.png
  9. ios_第10步.png
  10. ios_第二階段＿第一步.png
  11. ios_第二階段＿第一步.png
  12. ios_第二階段＿第二步.png

- **文案對應**（`IOS_QRCODE_TEXT_INDEX`）：
  - 0, 0, 0 → 文案1（installation_via_qr_code.steps[0]）
  - 1, 1    → 文案2（installation_via_qr_code.steps[1]）
  - 2       → 文案3（installation_via_qr_code.steps[2]）
  - 3       → 文案4（installation_via_qr_code.steps[3]）
  - 4       → 文案5（installation_via_qr_code.steps[4]）
  - 5       → 文案6（installation_via_qr_code.steps[5]）
  - 6       → network_setup.steps[1]
  - 7       → network_setup.steps[2]
  - 8       → network_setup.steps[3]

---

### 3. 一鍵安裝（apple）

- **圖片順序**（`IOS_APPLE_IMAGES`）：
  1. app自動安裝.png
  2. ios_第六步.png
  3. ios_第八步.png
  4. ios_第九步.png
  5. ios_第10步.png
  6. ios_第二階段＿第一步.png
  7. ios_第二階段＿第一步.png
  8. ios_第二階段＿第二步.png

- **文案對應**（`IOS_APPLE_TEXT_INDEX`）：
  - 0 → 文案1（tInstall.installInstructions + '（Apple 直接安裝）'）
  - 1 → 文案2
  - 2 → 文案3
  - 3 → 文案4
  - 4 → 文案5
  - 5, 5 → network_setup.steps[1]（第6、7張圖同一文案）
  - 6 → network_setup.steps[2]

---

## Android

### 1. QR code 安裝（qrcode）

- **圖片順序**（`ANDROID_QRCODE_IMAGES`）：
  1. aos_第一步.png
  2. aos_第二步.png
  3. aos_第三步.png
  4. aos_第四步.png
  5. aos_第五步.png
  6. aos_第六步_QR code.png
  7. aos_第七步.png
  8. aos_第八步.png
  9. aos_第九步.png
  10. aos_第10步.png
  11. aos_第11步.png
  12. aos_第二階段＿第一步.png
  13. aos_第二階段＿第一步.png
  14. aos_第二階段＿第一步.png
  15. aos_第二階段＿第二步.png
  16. aos_第二階段＿第二步.png

- **文案對應**（`ANDROID_QRCODE_TEXT_INDEX`）：
  - 0, 0, 0 → 文案1（installation_via_qr_code.steps[0]）
  - 1       → 文案2（installation_via_qr_code.steps[1]）
  - 2       → 文案3（installation_via_qr_code.steps[2]）
  - 3, 3, 3, 3 → 文案4（installation_via_qr_code.steps[3]）
  - 4, 4   → 文案5（installation_via_qr_code.steps[4]）
  - 5      → network_setup.steps[1]
  - 6      → network_setup.steps[2]
  - 7      → network_setup.steps[3]
  - 8      → network_setup.steps[4]
  - 9      → network_setup.steps[5]

---

### 2. 手動安裝（manual）

- **圖片順序**（`ANDROID_MANUAL_IMAGES`）：
  1. aos_第一步.png
  2. aos_第二步.png
  3. aos_第三步.png
  4. aos_第四步.png
  5. aos_第五步.png
  6. aos_第六步_手動1.png
  7. aos_第六步_手動2.png
  8. aos_第七步.png
  9. aos_第八步.png
  10. aos_第九步.png
  11. aos_第10步.png
  12. aos_第11步.png
  13. aos_第二階段＿第一步.png
  14. aos_第二階段＿第一步.png
  15. aos_第二階段＿第一步.png
  16. aos_第二階段＿第二步.png
  17. aos_第二階段＿第二步.png

- **文案對應**（`ANDROID_MANUAL_TEXT_INDEX`）：
  - 0, 0, 0 → 文案1（installation_manual.steps[0]）
  - 1       → 文案2（installation_manual.steps[1]）
  - 2       → 文案3（installation_manual.steps[2]）
  - 3       → 文案4（installation_manual.steps[3]）
  - 4, 4, 4, 4 → 文案5（installation_manual.steps[4]）
  - 5, 5   → 文案6（installation_manual.steps[5]）
  - 6      → network_setup.steps[1]
  - 7      → network_setup.steps[2]
  - 8      → network_setup.steps[3]
  - 9      → network_setup.steps[4]
  - 10     → network_setup.steps[5]
  - 11     → network_setup.steps[6]

---

## 補充

- iOS/Android 的「手動安裝」和「QR code安裝」都會先顯示 installation_manual/installation_via_qr_code 的 steps，然後再接 network_setup 的 steps。
- iOS「一鍵安裝」只有第一步顯示「Apple 直接安裝」的文案，後面步驟顯示 network_setup 的文案。
- 每一張圖片對應的文案 index 由 `XXX_TEXT_INDEX` 陣列決定，會去 stepsArr 取出對應的文案。

---

如需更詳細的對應表（例如每一張圖對應哪一段文案內容），可以再告訴我！

---

_**User**_

我現在遇到一個問題，我的@InstallInstructions.tsx @index.ts airalo-install-instruction會根據我的語言向airalo請求對應的安裝文案對嗎？然而現在airalo的API有調整，只會有en的安裝文案，zh_tw就不會有，你仔細看我的檔案，然後告訴我你的想法與建議是什麼

---

_**Assistant**_

你的理解是正確的，根據你提供的 `InstallInstructions.tsx` 以及 `supabase/functions/airalo-install-instructions/index.ts`，目前的流程如下：

---

## 現有流程說明

1. **前端（InstallInstructions.tsx）**
   - 會根據使用者選擇的語言（如 zh_tw、en）向 API 發送請求，網址格式如下：
     ```
     https://lcfsxxncgqrhjtbfmtig.functions.supabase.co/airalo-install-instructions?iccid=xxx&language=zh_tw
     ```
   - 會將語言參數（language）一併傳給後端。

2. **後端（airalo-install-instructions/index.ts）**
   - 會把收到的 `iccid` 和 `language` 傳給 `getAiraloInstallInstructions`。
   - 這個 function 會去請求 Airalo API，理論上會根據語言回傳對應語言的安裝文案。

---

## 你遇到的問題

- **Airalo API 現在只會回傳英文（en）的安裝文案**，即使你傳 `zh_tw`，也只會有英文內容，或甚至直接沒有 zh_tw 的內容。
- 這會導致你的前端在切換語言時，可能拿不到任何文案（API 回傳 null 或空），或只拿到英文。

---

## 我的建議

### 1. **後端 fallback 機制（推薦）**

在 `supabase/functions/airalo-install-instructions/index.ts` 或 `getAiraloInstallInstructions` 裡，加入「語言 fallback」邏輯：

- 當請求非英文語言（如 zh_tw），但 Airalo API 沒有對應語言的文案時，自動 fallback 回英文（en）。
- 這樣前端不管傳什麼語言，至少都能拿到英文文案，不會出現空白。

**範例邏輯：**
```typescript
const result = await getAiraloInstallInstructions(iccid, language);
if (!result || !result.instructions) {
  // fallback to English
  if (language !== 'en') {
    const enResult = await getAiraloInstallInstructions(iccid, 'en');
    return new Response(JSON.stringify(enResult), { ... });
  }
}
return new Response(JSON.stringify(result), { ... });
```

### 2. **前端 fallback 機制（可選）**

- 前端收到空文案時，也可以自動再請求一次英文（en），但這樣會多一次 API call，建議還是後端處理比較好。

### 3. **UI 提示**

- 若 fallback 到英文，建議在 UI 上顯示「目前僅提供英文安裝說明」的提示，讓用戶知道不是系統出錯。

---

## 結論

- **最佳做法**：在後端 `airalo-install-instructions` function 內，偵測到非英文語言沒資料時，自動 fallback 到英文，確保前端永遠有文案可顯示。
- **加分做法**：前端 UI 顯示「目前僅有英文安裝說明」的提示。
- **不建議**：完全依賴前端 fallback，這樣會多一次 API 請求且體驗較差。

---

如需範例程式碼或協助修改，請告訴我！

---

_**User**_

我有一個想法，就是當後端請求zh-TW，airalo回傳空陣列的時候，前端這邊就直接提供中文的教學文案(硬編碼)這樣你覺得如何

---

_**Assistant**_

你的想法是可行的，而且在目前 Airalo API 不支援 zh-TW 的情況下，這是一個很實用的解法。  
以下是這種做法的優缺點與建議：

---

## 優點

1. **用戶體驗佳**：使用者切換到繁體中文時，仍然能看到完整的中文教學文案，不會出現空白或英文。
2. **彈性高**：你可以根據台灣用戶的習慣，優化教學內容，不必受限於 Airalo 的英文原文。
3. **實作簡單**：只要在前端判斷 zh-TW 且 API 回傳空時，直接顯示本地硬編碼的文案即可。

---

## 缺點

1. **維護成本**：如果 Airalo 未來有更新教學步驟，你需要手動同步更新硬編碼的中文文案。
2. **多語系擴展性**：如果未來要支援更多語言，每種語言都要硬編碼一份，維護上會更複雜。
3. **資料一致性**：硬編碼內容與 Airalo API 內容可能會有落差，需定期檢查同步。

---

## 建議實作方式

1. **前端判斷**：  
   - 當語言為 zh-TW 且 API 回傳空陣列或無 instructions 時，直接載入本地的中文教學文案。
2. **硬編碼文案**：  
   - 建議將中文教學文案集中寫在一個檔案（如 `src/data/zh_tw_install_instructions.ts`），方便維護與管理。
3. **UI 提示**：  
   - 可以在畫面上加註「本教學由 CANET 提供，僅供參考」等字樣，讓用戶知道這是本地內容。

---

## 實作範例（邏輯）

```typescript
// 假設 language === 'zh_tw' && !instructions
if (language === 'zh_tw' && (!instructions || !instructions.ios)) {
  // 載入本地硬編碼的中文教學文案
  setInstructions(localZhTwInstructions);
}
```

---

## 結論

這個做法完全可行，且能大幅提升台灣用戶體驗。  
只要你能接受未來 Airalo 更新時需要手動同步中文文案，這就是一個很實用的解法！

如需協助設計硬編碼文案的結構或範例，請隨時告訴我！

---

