<!-- Generated by SpecStory -->

# 付款頁面設計修改建議 (2025-04-21 17:12:45)

_**User**_

再確認付款頁中：

1移除地球的logo
2.在價格下方總計上方增加折扣碼的input框，記得中英版本都要有

---

_**Assistant**_

我來幫您修改付款頁面的設計。首先讓我們看看相關的代碼。

---

<details>
            <summary>Searched codebase "payment page confirmation total price discount code input" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `project/src/components/PaymentPage.tsx` | L389-434 |
| `project/src/components/PackageConfirmation.tsx` | L91-111 |
| `project/src/components/PaymentPage.tsx` | L325-360 |
| `project/src/components/PaymentPage.tsx` | L360-389 |
| `project/src/components/PaymentPage.tsx` | L1-13 |
| `project/src/components/PackageConfirmation.tsx` | L51-91 |
| `project/src/components/PackageConfirmation.tsx` | L12-51 |
| `project/src/components/PaymentPage.tsx` | L434-439 |
| `project/src/App.tsx` | L468-535 |
| `project/src/components/PaymentPage.tsx` | L234-290 |
| `project/src/components/PaymentPage.tsx` | L290-325 |
| `project/src/components/PaymentPage.tsx` | L136-198 |
| `project/src/components/PackageCard.tsx` | L116-136 |
| `project/src/components/SaveCardPage.tsx` | L70-113 |
| `project/src/components/PaymentPage.tsx` | L198-234 |
| `project/src/components/PaymentPage.tsx` | L13-15 |
| `project/src/App.tsx` | L67-140 |
| `project/src/components/SaveCardPage.tsx` | L113-140 |
| `project/src/components/PaymentPage.tsx` | L15-16 |
| `project/src/components/PaymentPage.tsx` | L16-76 |
| `project/src/components/PackageConfirmation.tsx` | L1-12 |
| `project/src/index.css` | L1-117 |
| `project/src/components/SaveCardPage.tsx` | L37-70 |
| `project/src/components/PackageList.tsx` | L99-140 |
| `project/src/components/PaymentPage.tsx` | L76-136 |

</details>

---

讓我們來修改確認購買頁面。我會先修改 `PackageConfirmation.tsx` 文件。

---

```diff
  import { type FC } from 'react';
- import { X, CreditCard, Globe, Signal, Calendar } from 'lucide-react';
+ import { X, CreditCard, Signal, Calendar } from 'lucide-react';
  import type { ESIMPackage } from '../types';
  import { useStore } from '../store';
                </div>
              </div>
- 
-             <div className="flex items-center gap-3">
-               <Globe className="text-[#4CD964]" size={24} />
-               <div>
-                 <p className="text-gray-600">{t.coverage}</p>
-                 <p className="text-lg font-semibold">{pkg.coverage}</p>
-               </div>
-             </div>
            </div>
  
-           <div className="mt-6 space-y-2">
+           <div className="mt-6 space-y-4">
              <div className="flex justify-between items-center text-gray-600">
                <span>{t.price}</span>
                <span className="text-xl font-bold">{pkg.currency} {pkg.price}</span>
              </div>
+             
+             <div className="flex items-center gap-2">
+               <input
+                 type="text"
+                 placeholder={language === 'en' ? "Enter discount code" : "輸入折扣碼"}
+                 className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4CD964] focus:border-transparent"
+               />
+               <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
+                 {language === 'en' ? "Apply" : "使用"}
+               </button>
+             </div>
+ 
              <div className="flex justify-between items-center">
                <span className="font-medium">{t.total}</span>
```

---

我已經完成了以下修改：

1. 移除了地球圖標（Globe）和相關的覆蓋範圍（coverage）顯示部分
2. 在價格和總計之間添加了折扣碼輸入框，包括：
   - 輸入框：根據語言顯示不同的佔位符文字（中/英）
   - 使用按鈕：同樣根據語言顯示不同文字（中/英）
   - 適當的樣式和間距

這些修改保持了原有的設計風格，同時添加了新的功能。折扣碼輸入框採用了與其他元素一致的設計語言，包括圓角、邊框和焦點狀態等。

您需要我進一步調整任何部分嗎？例如：
1. 調整折扣碼輸入框的樣式
2. 添加折扣碼驗證邏輯
3. 修改其他相關組件

---

_**User**_

我希望如果我輸入4242後，會顯示打9折，然後總計會顯示折扣後的價格

---

_**Assistant**_

我來幫您添加折扣碼的功能。我們需要添加狀態來管理折扣碼和折扣後的價格。

---

```diff
- import { type FC } from 'react';
+ import { type FC, useState } from 'react';
  import { X, CreditCard, Signal, Calendar } from 'lucide-react';
  import type { ESIMPackage } from '../types';
    const { language } = useStore();
    const t = translations[language] as Record<TranslationKey, string>;
+   const [discountCode, setDiscountCode] = useState('');
+   const [isDiscountApplied, setIsDiscountApplied] = useState(false);
+   
+   const handleDiscountCode = () => {
+     if (discountCode === '4242') {
+       setIsDiscountApplied(true);
+     } else {
+       setIsDiscountApplied(false);
+     }
+   };
+ 
+   const calculatePrice = () => {
+     if (isDiscountApplied) {
+       return (pkg.price * 0.9).toFixed(2); // 9折
+     }
+     return pkg.price.toFixed(2);
+   };
  
    return (
              <div className="flex justify-between items-center text-gray-600">
                <span>{t.price}</span>
-               <span className="text-xl font-bold">{pkg.currency} {pkg.price}</span>
+               <span className="text-xl font-bold">{pkg.currency} {pkg.price.toFixed(2)}</span>
              </div>
              
              <div className="flex items-center gap-2">
                <input
                  type="text"
+                 value={discountCode}
+                 onChange={(e) => setDiscountCode(e.target.value)}
                  placeholder={language === 'en' ? "Enter discount code" : "輸入折扣碼"}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#4CD964] focus:border-transparent"
                />
-               <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
+               <button 
+                 onClick={handleDiscountCode}
+                 className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
+               >
                  {language === 'en' ? "Apply" : "使用"}
                </button>
              </div>
+ 
+             {isDiscountApplied && (
+               <div className="flex justify-between items-center text-[#4CD964]">
+                 <span>{language === 'en' ? "Discount (10% off)" : "折扣 (9折)"}</span>
+                 <span>-{pkg.currency} {(pkg.price * 0.1).toFixed(2)}</span>
+               </div>
+             )}
  
              <div className="flex justify-between items-center">
                <span className="font-medium">{t.total}</span>
                <span className="text-2xl font-bold text-[#4CD964]">
-                 {pkg.currency} {pkg.price}
+                 {pkg.currency} {calculatePrice()}
                </span>
              </div>
```

---

我已經完成了以下修改：

1. 添加了狀態管理：
   - `discountCode`：存儲用戶輸入的折扣碼
   - `isDiscountApplied`：追踪折扣碼是否已應用

2. 添加了折扣碼邏輯：
   - 當輸入 "4242" 時會自動應用9折優惠
   - 其他折扣碼則不會有效果

3. 添加了價格計算功能：
   - 原價顯示在上方
   - 如果折扣碼有效，會顯示折扣金額（綠色顯示）
   - 總計金額會自動計算折扣後的價格

4. 優化了顯示效果：
   - 所有金額都保留兩位小數
   - 折扣信息使用綠色突出顯示
   - 根據語言顯示中文或英文的折扣說明

現在當您：
1. 輸入 "4242" 並點擊使用按鈕
2. 會顯示折扣金額（原價的10%）
3. 總計會自動更新為折扣後的金額（原價的90%）

需要我再調整任何部分嗎？例如：
1. 調整折扣顯示的樣式
2. 添加折扣碼驗證的動畫效果
3. 修改折扣計算的邏輯

---

_**User**_

付款頁面的金額沒有同步到，正確金額應該是要依據結帳確認頁的金額

---

_**Assistant**_

我明白了，我們需要將折扣後的金額傳遞到付款頁面。讓我們修改相關組件。

首先，我們需要修改 `PackageConfirmation` 組件，讓它能夠傳遞折扣後的金額：

---

```diff
  interface PackageConfirmationProps {
    package: ESIMPackage;
-   onConfirm: () => void;
+   onConfirm: (finalPrice: number) => void;
    onCancel: () => void;
  }
    const calculatePrice = () => {
      if (isDiscountApplied) {
-       return (pkg.price * 0.9).toFixed(2); // 9折
+       return parseFloat((pkg.price * 0.9).toFixed(2)); // 9折
      }
-     return pkg.price.toFixed(2);
+     return pkg.price;
    };
  
                <span className="font-medium">{t.total}</span>
                <span className="text-2xl font-bold text-[#4CD964]">
-                 {pkg.currency} {calculatePrice()}
+                 {pkg.currency} {calculatePrice().toFixed(2)}
                </span>
              </div>
          <div className="p-6 space-y-3">
            <button
-             onClick={onConfirm}
+             onClick={() => onConfirm(calculatePrice())}
              className="w-full bg-[#4CD964] hover:bg-[#40c357] text-white py-3 rounded-full transition-colors font-medium flex items-center justify-center gap-2"
            >
```

---

現在讓我們修改 App.tsx 來處理折扣後的價格：

---

```diff
      totalData?: string;
    }>>([]);
+   const [discountedPrice, setDiscountedPrice] = useState<number | null>(null);
    const t = translations[language];
  
    };
  
-   const handleConfirmationProceed = () => {
+   const handleConfirmationProceed = (finalPrice: number) => {
+     setDiscountedPrice(finalPrice);
      setShowPackageConfirmation(false);
      setShowPayment(true);
        {selectedPackage && showPayment && (
          <PaymentPage
-           package={selectedPackage}
+           package={{
+             ...selectedPackage,
+             price: discountedPrice || selectedPackage.price
+           }}
            onClose={() => {
              setShowPayment(false);
              setShowPackageList(true);
+             setDiscountedPrice(null);
            }}
            onPurchaseComplete={handlePurchaseComplete}
```

---

我已經完成了以下修改：

1. 在 `PackageConfirmation` 組件中：
   - 修改了 `onConfirm` 的類型，使其接受折扣後的價格參數
   - 修改了 `calculatePrice` 函數，返回數字而不是字符串
   - 更新了確認按鈕的點擊處理函數，傳遞折扣後的價格

2. 在 `App` 組件中：
   - 添加了 `discountedPrice` 狀態來存儲折扣後的價格
   - 更新了 `handleConfirmationProceed` 函數，接收並保存折扣後的價格
   - 修改了 `PaymentPage` 組件的 props，傳遞折扣後的價格
   - 在關閉付款頁面時重置折扣價格

現在，當您：
1. 在確認頁面輸入折扣碼 "4242"
2. 點擊確認按鈕進入付款頁面
3. 付款頁面會顯示折扣後的價格（原價的90%）

這樣確保了價格在整個購買流程中保持一致。需要我再調整任何部分嗎？

---

_**User**_

兩個問題

1.在確認頁面，如果我輸入折扣碼後，畫面的比例會跑掉，會看不到取消按鈕與左上角的x

2.在購買後，我的esim裡面顯示已購買的esim價格也要跟實際結帳的金額同步，截圖中還是顯示沒有折扣後的價格

---

_**Assistant**_

讓我們來解決這兩個問題：

1. 首先修改確認頁面的樣式，確保內容不會溢出：

---

```diff
    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
-       <div className="bg-white rounded-2xl w-full max-w-lg">
-         <div className="p-6">
-           <div className="flex items-center justify-between mb-6">
+       <div className="bg-white rounded-2xl w-full max-w-lg max-h-[90vh] flex flex-col">
+         <div className="p-6 border-b border-gray-100 overflow-y-auto">
+           <div className="flex items-center justify-between mb-6 sticky top-0 bg-white z-10">
              <h2 className="text-xl font-bold text-[#4CD964]">
                {t.confirmPurchase}
          </div>
  
-         <div className="p-6 space-y-3">
+         <div className="p-6 border-t border-gray-100 bg-white">
            <button
              onClick={() => onConfirm(calculatePrice())}
-             className="w-full bg-[#4CD964] hover:bg-[#40c357] text-white py-3 rounded-full transition-colors font-medium flex items-center justify-center gap-2"
+             className="w-full bg-[#4CD964] hover:bg-[#40c357] text-white py-3 rounded-full transition-colors font-medium flex items-center justify-center gap-2 mb-3"
            >
              <CreditCard size={20} />
```

---

2. 現在修改購買完成的邏輯，確保折扣價格同步到已購買的 eSIM：

---

```diff
        const newEsim = {
          ...selectedPackage,
+         price: discountedPrice || selectedPackage.price,
          status: 'active' as const,
          activationDate: new Date().toISOString().split('T')[0],
      setShowPayment(false);
      setSelectedPackage(null);
+     setDiscountedPrice(null);
      setActiveTab('esims');
    };
```

---

我已經完成了以下修改：

1. 確認頁面的樣式問題：
   - 添加了最大高度限制 `max-h-[90vh]`
   - 使用 `flex flex-col` 確保內容正確排列
   - 添加了內容區域的滾動 `overflow-y-auto`
   - 固定了頂部標題和關閉按鈕 `sticky top-0`
   - 確保底部按鈕始終可見

2. 購買後的價格同步：
   - 在 `handlePurchaseComplete` 中使用 `discountedPrice` 更新已購買的 eSIM 價格
   - 購買完成後重置折扣價格狀態
   - 確保顯示在"我的 eSIM"中的價格是實際支付的金額

這些修改應該可以解決：
1. 確認頁面的排版問題，確保所有按鈕都可見
2. 確保折扣後的價格正確同步到已購買的 eSIM 列表中

需要我再調整其他部分嗎？

---

_**User**_

我不想要添加了內容區域的滾動跟固定了頂部標題和關閉按鈕，幫我調整畫面比例就好

---

_**Assistant**_

好的，我來調整確認頁面的樣式，只專注於畫面比例的問題：

---



---

